\chapwithtoc{Conclusion}\label{chap:conclusion}

The goal of this thesis was to explore the advantages effect systems can have for implementing a complex game engine as well as a simple and ergonomic API. For the engine implementation, we discussed some problems in \cref{chap:discussion}, which are mostly to the Effekt language specifically. One of them is the lack of visibility modifiers in the Effekt. The other and more general problem is capturing effect operations in a local function and using that to call a handler that has a second, local, implementation that should be used instead, resulting in unintended API usage.

In general we showed that effect systems can be very helpful for designing a game engine, as it can reduce code size while simulatnuously allowing for complex control flow and maintaining readability. The ECS implementation has only about 800 lines of code, which is the main part of the engine. The effect system also allows for great modularity, making the Core Engine, Canvas Renderer and Input modules, as well as the game developer`s actual game code, easy to integrate and expand with the game engine. Some important features to make this work in Effekt are lexical effect handlers, contextual effect polymorphism, executing code after resumption, bidirectional effects, named effect handlers and existential types.

Designing a simple, straightforward and ergonomic API is also possible with effects and handlers. We showed that an API similar to established ECS libraries and game engines can be implemented with a few effect interfaces that are free to use for the game developer. These contain simple effect operations to read and modify the world, define and use components and resources, as well as create queries and systems that can be registered to run every frame. For the API, lexical effect handlers, contextual effect polymorphism, bidirectional effects and named effect handlers were also some of the most important features to achieve this.

\section*{Potential applications}

The solution presented in this thesis can be used to develop simple 2D games with Effekt. This can be the basis for future work regarding game engines, entity component systems and the Effekt language. It can also serve as a benchmark for future improvements of the Effekt language in a relatively big, complicated and performance intensive environment.

\section*{Future work}

\begin{itemize}
\item[] \textbf{LLVM port:} The current implementation uses the \textsf{js-web} target to simplify window creation, rendering backend and input by using the javascript events and canvas API. To port the game engine to LLVM, a window, input and rendering backend library compatible with LLVM would be needed. This could potentially be written (partially) in Effekt as well, or a language like C++/Rust. With this backend library, porting the game engine itself is trivial, as it uses almost no javascript specific functions apart from rendering and input handling. This could form some future research work, as that would improve performance and make it more predictable. It could then be compared to other ECS libraries, game engines and optimizations could be found and analyzed.
\item[] \textbf{Query optimization:} Queries currently update their matching archetypes once per frame if any structural changes happend in that time. This could be optimized by creating a change detection system, for example on a per-component type or per-archetype basis, so not every query would need to be updated, or not all archetypes checked on update. These ideas and more could be part of a future research work.
\item[] \textbf{Additional features:} The game engine is currently quite bare, only providing the minimum to create games much faster than without an engine while keeping a stable and extensible architecture with the ECS. Future work could expand the capabilities by adding entity hierarchies, textures/sprites, physics, making it 3D capable or other features. With an LLVM port, the possibility to use existing and capable 3D graphics or physics libraries and interfacing them with the game engine could be evaluated.
\item[] \textbf{Bigger case study game:} As mentioned in \cref{sec:memoryproblem}, even simple games do not run longer than one or two minutes becaues of a memory problem with the game loop function and the javascript backend. This only occurs for javascript, so future work could either modify Effekt or research a workaround that collects the memory of each frame. An alternative would be the LLVM port, which does not have the problem in the first place. In both cases, future work could also contain the case study of a bigger game, to better showcase the ECS advantages, as larger and more complicated games benefit more from the engine architecture. A more complicated game has not been implemented in this thesis for time reasons, as well as the memory problem.
\end{itemize}

\section*{Effekt language benefits and problems}

While developing our game engine in Effekt, we came across quite a few problems, which were also in significant parts related to compiler bugs. The main reason behind this was that our game engine was one of the biggest and most complicated projects actually implemented in Effekt so far, but most of these bugs were fixed and the language generally improved during the implementation time.

After learning the concepts of Effekt and implementing a complicated project using it, we came to the conclusion that Effekt is very promising as a research language in general, while also having one of the best and easiest to use effect systems we have seen so far. It is relatively easy to learn and the effect system combined with all the concepts of the language make it very ergonomic to work with. We can recommend Effekt for future research and even small usable projects in many areas that could benefit from effect systems.
